self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.MailBoot~EventsNow.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[499],{1346:function(t,e,n){"use strict";function r(t,e){return!t.some((function(t){return t&&e&&t.calculatedFolderId===e.calculatedFolderId}))}function c(t,e){return t.indexOf(e)<0}function u(t,e){if(void 0===e&&(e=c),!t)return[];var n=[];return t&&t.forEach((function(t){e(n,t)&&n.push(t)})),n}var i=n(18);function o(t,e){if(void 0===e&&(e=c),!t)return t;var n=new i.ObservableMap;return t.forEach((function(t,r){n.set(r,u(t,e))})),n}function a(t,e){if(void 0===e&&(e=c),!t)return[];var n=[];return t.forEach((function(t){t&&t.forEach((function(t){e(n,t)&&n.push(t)}))})),n}n.d(e,"a",(function(){return r})),n.d(e,"b",(function(){return u})),n.d(e,"c",(function(){return o})),n.d(e,"d",(function(){return a}))},1561:function(t,e,n){"use strict";var r=n(3),c=Object(r.action)("UPDATE_SELECTED_CALENDARS_IN_STORE",(function(t,e){return{calendarIds:t,userIdentity:e}})),u=Object(r.action)("ADD_SELECTED_CALENDAR_IN_STORE",(function(t,e){return{calendarId:t,userIdentity:e}})),i={selectedCalendars:new(n(18).ObservableMap)},o=Object(r.createStore)("selectedCalendarsStore",i),a=n(1346);Object(r.mutator)(c,(function(t){var e=t.calendarIds,n=t.userIdentity;o().selectedCalendars.set(n,Object(a.b)(e))}));var d=n(0);function f(){return Object(a.c)(o().selectedCalendars)}function s(){return Object(a.d)(f())}function b(t){var e=f().get(t);return e||[]}Object(r.mutator)(u,(function(t){var e=t.calendarId,n=t.userIdentity;o().selectedCalendars.set(n,Object(a.b)(Object(d.__spread)(b(n),[e])))}));var l=Object(r.action)("UPDATE_SELECTED_CALENDARS",(function(t,e){return{calendarIds:t,userIdentity:e}})),v=Object(r.action)("ADD_SELECTED_CALENDAR",(function(t,e){return{calendarId:t,userIdentity:e}})),O=(Object(r.action)("INITIALIZE_SELECTED_CALENDARS",(function(t,e){return{calendarIds:t,userIdentity:e}})),Object(r.action)("SELECTED_CALENDARS_UPDATED",(function(t,e){return{calendarIds:t,userIdentity:e}}))),j=n(287),I=n(52),E=n(98),h=n(431),_="OWA.ViewStateConfiguration";function C(t,e){return Object(d.__awaiter)(this,void 0,void 0,(function(){return Object(d.__generator)(this,(function(n){return t&&E.v.importAndExecute([{key:"SelectedCalendarsDesktop",valuetype:"StringArray",value:Object(a.b)(t)}],_,Object(h.a)(Object(j.d)(e))).catch((function(t){I.g.warn("Could not save new selected calendars list to user configuration")})),[2]}))}))}function p(t){return t?function(t){var e=f().get(t);return e?e.length:0}(t):(e=f(),n=0,e.forEach((function(t,e){t&&(n+=t.length)})),n);var e,n}Object(r.orchestrator)(l,(function(t){var e=t.calendarIds,n=t.userIdentity;c(e,n),O(e,n),C(e,n)})),Object(r.orchestrator)(v,(function(t){var e=t.calendarId,n=t.userIdentity;u(e,n);var r=b(n);O(r,n),C(r,n)})),Object(r.orchestrator)(E.A,(function(t){var e=t.userConfiguration,n=t.userIdentity,r=e.ViewStateConfiguration.SelectedCalendarsDesktop,u=n||Object(j.d)().userIdentity;c(r,u),O(r,u)})),n.d(e,"g",(function(){return l})),n.d(e,"a",(function(){return v})),n.d(e,"f",(function(){return O})),n.d(e,"e",(function(){return b})),n.d(e,"c",(function(){return p})),n.d(e,"b",(function(){return f})),n.d(e,"d",(function(){return s}))},2660:function(t,e,n){"use strict";var r=n(3),c=Object(r.action)("updateUpNextEvent",(function(t,e){return{id:t,eventsCacheLockId:e}})),u={scenarios:new(n(18).ObservableMap)},i=Object(r.createStore)("UpNextStore",u);Object(r.mutator)(c,(function(t){i().scenarios.set(t.eventsCacheLockId,t.id)}));var o=n(1229),a=n(0),d=n(1614),f=(Object(r.action)("cancelRefreshUpNextPoll",(function(t){return{eventsCacheLockId:t}})),Object(r.action)("onUpNextEventUpdated",(function(t,e,n){return{id:t,parentFolderId:e,eventsCacheLockId:n}}))),s=Object(r.action)("initializeUpNextEventLoader",(function(t,e){return{calendarIds:t,eventsCacheLockId:e}})),b=n(9);function l(){var t=Object(b.kc)(),e=Object(b.e)(t,1);return{start:t,end:Object(b.A)(e)}}var v=n(1192),O=n(2053),j=n(1760),I=n(30);function E(t,e){void 0===e&&(e=!1);var n=Object(b.Pb)(),r=Object(a.__spread)(t);return e||r.sort(j.a),function(t,e){if(!t||0===t.length)return null;var n=h(e),r=t.filter((function(r,c){return!!n(r)&&!t.slice(c+1).some((function(t){return Object(b.Gb)(t.End,e)}))}));if(0===r.length)return null;if(1===r.length)return r[0];return r.reduce((function(t,n){if(0===t.length)return[n];var r=_(t[0].Start,e),c=_(n.Start,e);return c<r?[n]:c===r?(t.push(n),t):t}),[]).sort(j.b)[0]}(r,n)}function h(t){return function(e){var n=Object(b.Gb)(e.End,t),r=Object(b.w)(e.End,e.Start)>I.e,c=!Object(O.c)(e),u=Object(v.v)(e);return!n&&!r&&!e.IsAllDayEvent&&!e.IsCancelled&&!e.IsDraft&&"Decline"!==e.ResponseType&&c&&u}}function _(t,e){return Math.abs(Object(b.w)(t,e))}var C=n(1295);function p(t){var e=l();return Object(d.c)(t,e).filter(Object(C.d)(e))}var g=n(633);function S(t,e){var n=Object(g.i)();return e.ItemId.Id!==t.ItemId.Id&&(Object(j.f)(e,t)&&!Object(b.Eb)(e.Start,t.Start)&&h(n)(e))}function D(t){return i().scenarios.get(t)}function w(t){var e=D(t);return e?function(t,e){return p(t).filter((function(t){return t.ItemId.Id===e.Id}))[0]||null}(t,e):null}function A(t){var e=w(t);if(!e)return{upNextEvent:null,conflictingEvents:[]};var n=p(t).filter((function(t){return S(e,t)}));return{upNextEvent:e,conflictingEvents:n}}function N(t){var e=w(t);if(!e)return{upNextEvent:null,eventsWithinUpNextEvent:[]};var n=p(t).filter((function(t){return function(t,e){if(e.ItemId.Id===t.ItemId.Id||!e.IsOnlineMeeting||null===e.OnlineMeetingJoinUrl)return!1;var n=Object(b.Mb)(Object(b.ec)(Object(b.Pb)(),1),e.Start,e.End),r=Object(b.Mb)(Object(b.Pb)(),e.Start,e.End),c=Object(b.w)(e.End,e.Start)>I.e;return(n||r)&&!c&&!e.IsAllDayEvent&&!e.IsCancelled&&!e.IsDraft&&"Decline"!==e.ResponseType&&!Object(O.c)(e)&&Object(v.v)(e)}(e,t)}));return{upNextEvent:e,eventsWithinUpNextEvent:n}}function L(t){return i().scenarios.has(t)}function y(){return Object(a.__spread)(i().scenarios.keys())}function k(t){return Object(a.__awaiter)(this,void 0,void 0,(function(){var e,n;return Object(a.__generator)(this,(function(r){return e=function(t){return E(p(t),!0)}(t),n=e?e.ItemId:null,D(t)===n?[2]:(c(n,t),f(n,e?e.ParentFolderId:null,t),[2])}))}))}function m(){y().forEach(k)}Object(r.orchestrator)(o.b,(function(){m()})),Object(r.orchestrator)(o.c,(function(){m()})),Object(r.orchestrator)(o.a,(function(){m()})),Object(r.orchestrator)(s,(function(t){var e=t.calendarIds,n=t.eventsCacheLockId,r=l();L(n)||c(null,n),Object(d.h)(e,r,n)}));var x=n(4219);Object(r.orchestrator)(d.a,(function(t){return Object(a.__awaiter)(void 0,void 0,void 0,(function(){var e;return Object(a.__generator)(this,(function(n){switch(n.label){case 0:return L(e=t.eventsCacheLockId)?[4,k(e)]:[3,2];case 1:n.sent(),Object(x.b)((function(){return function(t){return Object(a.__awaiter)(this,void 0,void 0,(function(){return Object(a.__generator)(this,(function(e){switch(e.label){case 0:return[4,k(t)];case 1:return e.sent(),[2,null]}}))}))}(e)}),e,1e4),n.label=2;case 2:return[2]}}))}))}));Object(r.orchestrator)(d.k,(function(t){var e=t.eventsCacheLockId;L(e)&&k(e)})),Object(r.orchestrator)(g.l,(function(){y().forEach((function(t){return Object(d.m)(l(),t)}))})),Object(r.orchestrator)(d.j,(function(t){var e=t.eventsCacheLockId;L(e)&&k(e)}));n.d(e,"h",(function(){return f})),n.d(e,"e",(function(){return s})),n.d(e,"j",(function(){return d.l})),n.d(e,"a",(function(){return w})),n.d(e,"b",(function(){return D})),n.d(e,"c",(function(){return A})),n.d(e,"d",(function(){return N})),n.d(e,"g",(function(){return L})),n.d(e,"f",(function(){return S})),n.d(e,"i",(function(){return m}))},9006:function(t,e,n){"use strict";n.r(e);var r=n(3),c=n(2660),u=n(1614),i=n(1229),o=Object(i.f)("CalendarSurface_EventsNowCalendarCacheId");function a(){return o.getLockId()}var d=n(1463),f=n(633);Object(r.orchestrator)(f.j,(function(){var t=a();if(Object(c.g)(t)){var e=Object(c.d)(t),n=e.upNextEvent,r=e.eventsWithinUpNextEvent;if(n&&(Object(d.c)(n,!0)||Object(u.i)(t,n.ItemId),r))for(var i=0;i<r.length;i++)Object(d.c)(r[i],!0)||Object(u.i)(t,r[i].ItemId)}}));var s=n(1561);function b(){var t=Object(s.d)();Object(c.e)(t,a()),Object(c.i)()}function l(){var t=a();return Object(c.g)(t)?Object(c.a)(t):null}Object(r.orchestrator)(s.f,(function(){var t=a();Object(c.g)(t)&&Object(u.l)(Object(s.d)(),t)})),n.d(e,"initializeEventsNow",(function(){return b})),n.d(e,"getNowEvent",(function(){return l}))}}]);
//# sourceMappingURL=owa.MailBoot~EventsNow.js.map
self.scriptsLoaded['owa.MailBoot~EventsNow.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.MailBoot~EventsNow.js'] = (new Date()).getTime();