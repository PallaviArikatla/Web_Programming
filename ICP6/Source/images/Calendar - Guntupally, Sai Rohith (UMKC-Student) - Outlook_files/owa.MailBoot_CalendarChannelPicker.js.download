self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.MailBoot~CalendarChannelPicker.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[449,797],{10003:function(e){e.exports=JSON.parse('{"b":"Yra","d":"Zra","c":"_ra","a":"$ra"}')},16378:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n(3),i=Object(a.action)("createCalendarPickerOptions",(function(e){return{event:e}})),o=Object(a.action)("createTeamsChannelsOptions",(function(e){return{account:e}})),c=Object(a.createStore)("CalendarChannelPickerStore",{options:[],filteredOptions:[],selectedOption:null,textFieldValue:"",navIndex:0}),s=n(373),u=n(287);function l(){return[Object(u.d)().userIdentity].concat(Object(s.n)().map((function(e){return e.userIdentity})))}function d(){return l().length>1}var f=n(179),m=n(11),b=n(3819),v=n(10003);function O(e,t){return t?Object(b.a)(t)?function(e,t){var n=d();if(null==t?void 0:t.calendar)return n?Object(m.c)(Object(m.b)(v.b),t.calendar.displayName,t.account):t.calendar.displayName||"";return h(e)}(e,t):Object(b.b)(t)?function(e){var t=d();if(null==e?void 0:e.displayName)return t?Object(m.c)(Object(m.b)(v.d),e.parentTeamName,e.displayName,e.account):Object(m.c)(Object(m.b)(v.c),e.parentTeamName,e.displayName);return""}(t):"":""}function h(e){var t=d(),n=Object(f.u)(e.ParentFolderId.Id);if(!n)return"";var r=Object(f.j)(n.id);if(!r)return"";var a=r.displayName;if(!a)return"";if(t){var i=r.id.mailboxInfo.userIdentity;return i?Object(m.c)(Object(m.b)(v.b),a,i):a}return a}var p=n(1894);function j(e,t){var n=e.ItemId?Object(p.a)(e).EmailAddress:null;return Object(f.g)().filter((function(e){return Object(f.N)(e)&&!Object(f.L)(e)&&(!n||Object(f.F)(e,n))&&e.id.mailboxInfo.userIdentity===t}))}var g=n(3705);Object(a.orchestrator)(i,(function(e){var t,n,a,i,o=e.event,s=Object(u.d)().userIdentity,d=l(),m=Object(f.u)(o.ParentFolderId.Id),b=0;try{for(var v=Object(r.__values)(d),h=v.next();!h.done;h=v.next()){var p=h.value,y=s===p,C=j(o,p),x=[];try{for(var I=(a=void 0,Object(r.__values)(C)),k=I.next();!k.done;k=I.next()){var N=k.value,T=N.id.id==(null==m?void 0:m.id),w={id:N.id.id,displayName:N.displayName||"",calendar:N,account:p,isShown:!0,index:b};x.push(w),b++,T&&Object(g.g)(c(),(function(e){return O(o,e)}),w)}}catch(e){a={error:e}}finally{try{k&&!k.done&&(i=I.return)&&i.call(I)}finally{if(a)throw a.error}}var S=Object(g.d)(c(),p);if(S)Object(g.k)(S,x),0===S.leafOptions.length&&0===S.parentOptions.length&&Object(g.i)(c(),S);else if(x.length>0){var E={account:p,isPrimaryAccount:y,leafOptions:x,parentOptions:[]};Object(g.c)(c(),E)}}}catch(e){t={error:e}}finally{try{h&&!h.done&&(n=v.return)&&n.call(v)}finally{if(t)throw t.error}}}));var y=n(9077);Object(a.orchestrator)(o,(function(e){return Object(r.__awaiter)(void 0,void 0,void 0,(function(){var t,n,a,i,o,s,u,l,d,f,m,b,v,O,h,p,j,C,x,I,k;return Object(r.__generator)(this,(function(N){switch(N.label){case 0:t=e.account,n=[],N.label=1;case 1:return N.trys.push([1,3,,4]),[4,Object(y.b)()];case 2:return a=N.sent(),[3,4];case 3:return N.sent(),[2];case 4:N.trys.push([4,12,13,14]),i=Object(r.__values)(a),o=i.next(),N.label=5;case 5:if(o.done)return[3,11];if(s=o.value,u=[],s.channels)try{for(C=void 0,l=Object(r.__values)(s.channels),d=l.next();!d.done;d=l.next())f=d.value,m={account:t,displayName:f.displayName,id:f.id,uid:f.creator?f.creator.substring(0,f.creator.indexOf(";")):"",rid:(null===(I=f.lastMessage)||void 0===I?void 0:I.id)?parseInt(f.lastMessage.id):0,mid:(null===(k=f.lastMessage)||void 0===k?void 0:k.parentMessageId)?parseInt(f.lastMessage.parentMessageId):0,channelType:f.channelType,private:!1,parentId:f.parentTeamId,parentTeamName:s.displayName,parentTeamSmtpAddress:s.smtpAddress,isShown:!1,isFavorite:f.isFavorite,index:0},u.push(m)}catch(e){C={error:e}}finally{try{d&&!d.done&&(x=l.return)&&x.call(l)}finally{if(C)throw C.error}}b=void 0,N.label=6;case 6:return N.trys.push([6,8,,9]),[4,Object(y.a)(s)];case 7:return v=N.sent(),b=URL.createObjectURL(v),[3,9];case 8:return N.sent(),b="",[3,9];case 9:O={account:t,displayName:s.displayName,id:s.id,smtpAddress:s.smtpAddress,profilePictureUrl:b,isExpanded:!1,isFavorite:s.isFavorite,isShown:!0,children:u,index:0},n.push(O),N.label=10;case 10:return o=i.next(),[3,5];case 11:return[3,14];case 12:return h=N.sent(),p={error:h},[3,14];case 13:try{o&&!o.done&&(j=i.return)&&j.call(i)}finally{if(p)throw p.error}return[7];case 14:return Object(g.b)(c(),n),Object(g.h)(c()),[2]}}))}))}));var C=Object(a.action)("initializeCalendarChannelPicker",(function(e){return{event:e}})),x=n(84),I=n(156),k=n(2);Object(a.orchestrator)(C,(function(e){i(e.event);var t=Object(g.e)(c());t&&(Object(x.i)("cal-mf-calendarPickerTeams")||Object(I.d)()&&Object(k.u)()===k.e)&&o(t.account),Object(g.j)(c())}));var N=n(47),T=n(319),w=n(355),S=n(82),E=n(13),F=n(704),P=n(2206),_=n(1),L=n(5226),A=n(372).bind(L),R=Object(N.a)((function(e){var t,n,a,i=Object(x.i)("cal-mf-calendarPickerV2")||Object(s.p)(),o=e.readonly||i?void 0:Object(P.a)(e.colorScheme).bottomBorder,u=i?A(L.textField,o):o,l=Object(E.mergeStyles)({backgroundColor:e.colorScheme.calLighter+"!important"}),d=h(e.event);return _.createElement(g.a,Object(r.__assign)({viewState:c()},e,{renderOption:M,defaultValue:d,formatOptionName:function(t){return O(e.event,t)},onChange:function(t){Object(b.a)(t)?e.onCalendarIdChanged(t.calendar.id):Object(b.b)(t)&&e.onChannelChanged(t)},styles:Object(r.__assign)(Object(r.__assign)({},e.styles),{pickerContainer:i?L.calendarPickerContainer:void 0,textField:A(null===(t=e.styles)||void 0===t?void 0:t.textField,u),textFieldGroup:i?L.textFieldGroup:void 0,textFieldSuffix:i?L.textFieldSuffix:void 0,textFieldRoot:i?A(null===(n=e.styles)||void 0===n?void 0:n.textFieldRoot,L.textFieldRoot):void 0,optionsContainer:A(null===(a=e.styles)||void 0===a?void 0:a.optionsContainer,L.optionsContainer),optionButton:L.optionButton,highlightedOptionButton:l}),pickerAriaLabel:Object(m.b)(v.a),useOptionLengthAsTextFieldWidth:i,hideParentOptionIfEmptyLeafOptions:!0,showChevronDownButton:i}))}));function M(e){return Object(b.a)(e)?(t=e,_.createElement(_.Fragment,null,_.createElement(T.a,{iconName:"CircleFill",className:L.circleFillIcon,styles:{root:{color:Object(F.b)(t.calendar.id).calPrimary}}}),_.createElement("span",{className:L.optionText},t.displayName))):Object(b.c)(e)?(n=e,_.createElement(_.Fragment,null,n.profilePictureUrl&&_.createElement(w.a,{className:L.teamProfilePicture,src:n.profilePictureUrl,imageFit:S.b.cover}),_.createElement("span",{className:L.optionText},n.displayName))):function(e){return _.createElement("span",{className:L.channelText},e.displayName)}(e);var t,n}n.d(t,"initializeCalendarChannelPicker",(function(){return C})),n.d(t,"CalendarChannelPicker",(function(){return R}))},1894:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(29),a=n(1192),i=n(179),o=n(373),c=n(98);function s(e){var t;if(null===(t=e.ParentFolderId)||void 0===t?void 0:t.Id){if(Object(a.C)(e)){var n=Object(i.o)(e.ParentFolderId.Id);if(n){var s=n;if(s.SharedOwnerEmailAddress&&s.SharedOwnerName)return{EmailAddress:s.SharedOwnerEmailAddress,Name:s.SharedOwnerName};var u=n;if(u.OwnerEmailAddress&&u.OwnerName)return{EmailAddress:u.OwnerEmailAddress,Name:u.OwnerName}}}if(e.ParentFolderId.mailboxInfo&&Object(o.r)(e.ParentFolderId.mailboxInfo.userIdentity)){var l=Object(c.i)(e.ParentFolderId.mailboxInfo.userIdentity),d=null;return(null==l?void 0:l.SessionSettings)&&(d=l.SessionSettings.UserDisplayName),{EmailAddress:e.ParentFolderId.mailboxInfo.userIdentity,Name:d}}}var f=Object(r.a)().SessionSettings;return{EmailAddress:f.UserEmailAddress,Name:f.UserDisplayName}}},433:function(e,t,n){"use strict";var r=function(){function e(e,t,n){this.maxParallelTasks=e,this.taskCallback=t,this.taskDelay=n,this.taskList=[],this.numberOfTasksRunning=0}return e.prototype.add=function(e){this.taskList.unshift(e),this.scheduleTask()},e.prototype.clear=function(){this.taskList.splice(0,this.taskList.length)},e.prototype.canRunMoreTasks=function(){return this.numberOfTasksRunning<this.maxParallelTasks&&this.taskList.length>0},e.prototype.scheduleTask=function(){var e=this;this.canRunMoreTasks()&&setTimeout((function(){e.tryRunTask()}),this.taskDelay)},e.prototype.onTaskComplete=function(){this.numberOfTasksRunning--,this.scheduleTask()},e.prototype.tryRunTask=function(){var e=this;if(this.canRunMoreTasks()){var t=this.taskList.pop();this.numberOfTasksRunning++,this.taskCallback(t).then((function(){e.onTaskComplete()})).catch((function(){e.onTaskComplete()})),this.scheduleTask()}},e}();n.d(t,"a",(function(){return r}))},704:function(e,t,n){"use strict";var r,a=n(80),i=n(3),o=n(312),c=n(179),s=n(638),u=n(52);var l=[0,5,1,3,8,6,7,2,4],d=l.map((function(e){return{isLocked:!1,count:0}}));function f(){return r||b(),r}function m(){return l.map((function(e){return f()[e]}))}function b(){r=Object(o.h)(),d=l.map((function(e){return{isLocked:!1,count:0}}))}function v(e,t){var n=void 0===e||-1===e?function(){for(var e=Number.MAX_VALUE,t=0,n=0;n<d.length;n++)!d[n].isLocked&&d[n].count<e&&(e=d[n].count,t=n);return t}():l.indexOf(e);h(n),t&&(d[n].isLocked=!0);var r=l[n],a=f();return r<0||r>=a.length?(u.g.warn("[getColorSchemeForCalendarColor] Calculated usedIndex is outsize default color scheme bounds"),a[a.length-1]):a[r]}function O(e){return Object(o.g)(e)}function h(e){if("number"==typeof e)d[e].count++;else{var t=l.indexOf(p(e));d[t].count++}}function p(e){return function(e,t){for(var n=0,r=e.length;n<r;n++){var a=e[n];if(t(a))return{item:a,index:n}}return null}(f(),(function(t){return t.calPrimary.toLowerCase()==e.toLowerCase()})).index}var j=Object(i.action)("COLOR_RESOLVER_SET_CALENDAR_COLORSCHEME",(function(e,t){return{calendarId:e,colorScheme:t}})),g={assignedCalendarColors:new(n(18).ObservableMap)},y=Object(i.createStore)("calendarColorResolverStore",g);function C(e){return y().assignedCalendarColors.get(e)}function x(e){var t=Object(c.u)(e);if(t)return k(t);var n=C(e);return n||(u.g.warn("[getCalendarColorSchemeByFolderId] Failed to retrieve calendarId and to get assignedColor from calendarFolderId"),v(0))}function I(e){if(!e.ParentFolderId)return u.g.warn("[getCalendarEventColorScheme] Calendar item does not have parent folder id"),v(0);var t=null==e?void 0:e.Categories;return function(e,t){var n,r;if(t&&t.length>0){var a=void 0,i=Object(c.o)(e);if(null===(n=i)||void 0===n?void 0:n.RemoteCategories)a=i.RemoteCategories.MasterList;else{var u=Object(c.u)(e);a=Object(s.o)(u?u.mailboxInfo:null)}var l=Object(s.h)(t[0],a);r=Object(o.g)(l.iconColor)}else r=x(e);return r}(e.ParentFolderId.Id,t)}function k(e,t){var n=C(e.id);return n||(n=N(e,t)),n}function N(e,t){var n,r=Object(c.l)({id:e});return C(e.id)&&function(e){var t;t="string"==typeof e?p(e):e;var n=l.indexOf(t);d[n].count=Math.max(d[n].count-1,0),d[n].isLocked=!1}(C(e.id).calPrimary),(null==r?void 0:r.HexColorString)&&""!=r.HexColorString&&f().some((function(e){return e.calPrimary.toLowerCase()==r.HexColorString.toLowerCase()}))?(n=Object(o.g)(r.HexColorString),h(r.HexColorString)):(null==r?void 0:r.HexColorString)&&""!=r.HexColorString&&o.a.toLowerCase()==r.HexColorString.toLowerCase()?(n=Object(o.g)(o.b),h(o.b)):n=v(null==r?void 0:r.CalendarColor,t),j(e.id,n),n}function T(e){return!!C(e.id)}Object(i.orchestrator)(a.h,(function(){b(),y().assignedCalendarColors.forEach((function(e,t){N({id:t})}))})),Object(i.mutator)(j,(function(e){var t=e.calendarId,n=e.colorScheme;y().assignedCalendarColors.set(t,n)})),n.d(t,"c",(function(){return x})),n.d(t,"d",(function(){return I})),n.d(t,"b",(function(){return k})),n.d(t,"j",(function(){return N})),n.d(t,"i",(function(){return T})),n.d(t,"g",(function(){return f})),n.d(t,"f",(function(){return O})),n.d(t,"h",(function(){return m})),n.d(t,"e",(function(){return v})),n.d(t,"k",(function(){return j})),n.d(t,"a",(function(){return C}))},709:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return o}));var r=n(18),a=n(1);function i(e){return{get:e}}function o(e,t){return Object(a.useMemo)((function(){return Object(r.computed)(e)}),t).get()}},9077:function(e,t,n){"use strict";var r=n(0),a=n(325),i=n(458),o="https://chatsvcagg.teams.microsoft.com",c=o+"/api/v1/teams/users/me/teams";function s(){return Object(r.__awaiter)(this,void 0,void 0,(function(){var e,t;return Object(r.__generator)(this,(function(n){switch(n.label){case 0:return[4,Object(i.getAccessTokenforResource)(o)];case 1:if(!(e=n.sent()))throw Error("No access token for resource");return[4,fetch(c,{method:"GET",headers:{Authorization:"Bearer "+e,"Content-Type":"application/json"}})];case 2:return t=n.sent(),Object(a.a)(t.status)?[4,t.json()]:[3,4];case 3:return[2,n.sent()];case 4:throw Error("HTTP status "+t.status)}}))}))}var u="https://teams.microsoft.com";function l(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,n,o;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return e&&e.teamSiteInformation&&e.teamSiteInformation.groupId&&e.pictureETag&&e.displayName?(t=u+"/api/mt/beta/teams/"+e.teamSiteInformation.groupId+"/profilepicture?etag="+e.pictureETag+"&displayName="+e.displayName,[4,Object(i.getAccessTokenforResource)(u)]):[2,null];case 1:if(!(n=r.sent()))throw Error("No access token for resource");return[4,fetch(t,{method:"GET",headers:{Authorization:"Bearer "+n,"Content-Type":"application/json"}})];case 2:return o=r.sent(),Object(a.a)(o.status)?[4,o.blob()]:[3,4];case 3:return[2,r.sent()];case 4:throw Error("HTTP status "+o.status)}}))}))}n.d(t,"b",(function(){return s})),n.d(t,"a",(function(){return l}))}}]);
//# sourceMappingURL=owa.MailBoot~CalendarChannelPicker.js.map
self.scriptsLoaded['owa.MailBoot~CalendarChannelPicker.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.MailBoot~CalendarChannelPicker.js'] = (new Date()).getTime();