self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.MailBoot~owa-account-store-init.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[743],{1133:function(e,n,t){"use strict";t.r(n);var r=t(0),o=t(639),c=t(373),u=t(1413),i=t(287),s=t(2242),a=t(98);function d(e,n){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,d,l,b,f,O,v,p,j;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:t=e.userIdentity,d=e.accountProviderType,r.label=1;case 1:return r.trys.push([1,6,,7]),Object(c.d)(e),l=Object(i.d)(t),[4,Object(u.b)(l)];case 2:return b=r.sent(),f=Object(c.s)(t),b.headers&&f?[4,Object(s.a)(b)]:[3,4];case 3:return O=r.sent(),Object(a.x)(O,t),Object(o.c)(t,d),[3,5];case 4:v=b.headers?"Account invalid ":"Missing headers",Object(o.b)(t,n,d,v),r.label=5;case 5:return[3,7];case 6:return p=r.sent(),j="Exception"+p,Object(o.b)(t,n,d,j),[3,7];case 7:return[2]}}))}))}var l=t(2225),b=t(3),f=t(233),O=t(84),v=t(9),p=t(269);function j(e){return e<=0?{lowerBoundSeconds:null,upperBoundSeconds:0}:e<=30?{lowerBoundSeconds:0,upperBoundSeconds:30}:e<=60?{lowerBoundSeconds:30,upperBoundSeconds:60}:e<=300?{lowerBoundSeconds:60,upperBoundSeconds:300}:e<=600?{lowerBoundSeconds:300,upperBoundSeconds:600}:e<=1800?{lowerBoundSeconds:600,upperBoundSeconds:1800}:e<=3600?{lowerBoundSeconds:1800,upperBoundSeconds:3600}:e<=21600?{lowerBoundSeconds:3600,upperBoundSeconds:21600}:e<=43200?{lowerBoundSeconds:21600,upperBoundSeconds:43200}:e<=86400?{lowerBoundSeconds:43200,upperBoundSeconds:86400}:e>86400?{lowerBoundSeconds:86400,upperBoundSeconds:null}:{lowerBoundSeconds:null,upperBoundSeconds:null}}function S(e){switch(e.providerType){case l.c.Msa:case l.c.MsaInt:return!0;case l.c.Google:return Object(O.i)("cal-addCalendar-google");case l.c.TeamSnap:return!1;case l.c.ICloud:return Object(O.i)("cal-addCalendar-iCloud");default:return Object(f.a)(e.providerType)}}Object(b.orchestrator)(o.a,(function(){return Object(r.__awaiter)(void 0,void 0,void 0,(function(){var e,n,t;return Object(r.__generator)(this,(function(o){switch(o.label){case 0:return Object(c.h)()==c.a.AccountsLoadSuccessful?[2]:(Object(c.w)(c.a.None),[4,l.e.importAndExecute()]);case 1:return e=o.sent(),n=e,t=null==e?void 0:e.isSuccess,n.ConnectedAccountResponses&&"function"==typeof n.ConnectedAccountResponses.filter?[4,Promise.all(n.ConnectedAccountResponses.filter(S).map((function(e){return Object(r.__awaiter)(void 0,void 0,void 0,(function(){var n,o;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return n=function(e){switch(e){case l.c.Msa:return"Outlook";case l.c.Google:return"Google";case l.c.ICloud:return"ICloud";default:return Object(f.a)(e)}}(e.providerType),o=parseInt(e.token.expiresIn),Object(p.p)("hasConnectedAccount",{tokenExpiry:o,type_1:n,isNewCloudCacheMailboxProvisioned_2:e.newCloudCacheMailboxProvisioned,tokenExpiryLowerBound_3:j(o).lowerBoundSeconds,tokenExpirtyUpperBound_4:j(o).upperBoundSeconds},{isCore:!0}),[4,d({userIdentity:e.userAccount.emailAddress,accountId:e.userAccount.id,accountUniqueId:e.userAccount.accountUniqueId,anchorMailbox:e.userAccount.routingHint,token:e.token.accessToken,tokenExpiry:Object(v.j)(Object(v.Pb)(),o),accountProviderType:n,accountState:c.b.Valid},!1)];case 1:return r.sent(),Object(c.l)(e.userAccount.emailAddress)!=c.b.Valid&&(t=!1),[2]}}))}))})))]:[3,3];case 2:o.sent(),o.label=3;case 3:return Object(c.e)(t),[2]}}))}))})),Object(b.orchestrator)(o.d,(function(e){var n=e.userIdentity;return Object(r.__awaiter)(void 0,void 0,void 0,(function(){return Object(r.__generator)(this,(function(e){return Object(c.u)(n),Object(a.w)(n),Object(i.f)(n),[2]}))}))}));var w=t(1856);Object(b.orchestrator)(w.b,(function(e){d(Object(c.k)(e.userIdentity),!0)})),Object(b.orchestrator)(o.b,(function(e){var n=e.userIdentity,t=e.isRetry,r=e.accountProvider,o=e.error;(Object(p.p)("owaAccountStoreInitializationFailed",{error:o,accountProvider:r,isRetry:t},{isCore:!0}),t)?Object(c.x)(n,c.b.FailedToInitializeOWAConfig):d(Object(c.k)(n),!0)})),t.d(n,"initializeOwaAccountsStore",(function(){return o.a})),t.d(n,"removeOWAConnectedAccount",(function(){return o.d})),t.d(n,"owaAccountStoreInitializationFailed",(function(){return o.b})),t.d(n,"initializeOwaConnectedAccount",(function(){return d}))},1413:function(e,n,t){"use strict";var r=t(0),o=t(1856),c=t(373),u=t(633),i=t(269),s=t(9),a="X-AnchorMailbox",d="Authorization",l="X-OwaWebSessionType",b="X-OWA-ExplicitLogonUser";function f(e,n){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,f,O,v,p;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:if(t={},f=Object(c.k)(e)){if(f.accountState==c.b.AccessRevoked)return[2,null];if(f.accountState==c.b.AccountDeprovisioned||f.accountState==c.b.AccountNotFound)return Object(c.c)(f.accountState,f.accountProviderType),[2,null]}return n?(t[a]=n,t[b]=n):f&&(t[a]=f.anchorMailbox),f?(O=f.token,!(v=Object(u.g)(f.tokenExpiry))&&O?[3,2]:(Object(i.p)("getAndUpdateAccessToken",{tokenExpiry:Object(s.y)(f.tokenExpiry,Object(s.Pb)()),isTokenExpired_1:v,isTokenInvalid_2:!O},{isCore:!0}),[4,o.a.importAndExecute(f.accountId,e)])):[3,3];case 1:(O=r.sent())||(O=""),r.label=2;case 2:p=void 0,"Outlook"==f.accountProviderType?(p='MSAuth1.0 usertoken="'+O+'", type="MSACT"',t[l]=1..toString()):"Google"!=f.accountProviderType&&"ICloud"!=f.accountProviderType||(p="Bearer "+O,t[l]=2..toString()),t[d]=p,r.label=3;case 3:return[2,t]}}))}))}var O=t(1445),v=t(52);function p(e,n){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,o;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return t=Object(O.a)(e),o=t,[4,j(e,n)];case 1:return o.headers=r.sent(),t.authNeededOnUnAuthorized=!1,t.datapoint=t.datapoint||{},t.datapoint.mailbox="Connected",[2,t]}}))}))}function j(e,n){var t,o;return Object(r.__awaiter)(this,void 0,void 0,(function(){var c,u;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return c=n&&(null===(o=null===(t=null==e?void 0:e.requestOptions)||void 0===t?void 0:t.headers)||void 0===o?void 0:o.set)?new Headers(e.requestOptions.headers):new Headers,[4,f(e.userIdentity,S(e.type,e.mailboxSmtpAddress)?e.mailboxSmtpAddress:null)];case 1:return u=r.sent(),Object(O.b)(c,u),[2,c]}}))}))}function S(e,n){var t="GroupMailbox"==e||"TeamsMailbox"==e||"SharedMailbox"==e||"PublicMailbox"==e;return t&&null==n&&v.d("getHeadersForConnectedAccount: mailboxSmtpAddress should be passed for Group or Teams or Shared or Public Mbx request"),t}t.d(n,"a",(function(){return f})),t.d(n,"b",(function(){return p})),t.d(n,"c",(function(){return S}))},1445:function(e,n,t){"use strict";function r(e,n){Object.keys(n).forEach((function(t){return e.set(t,n[t])}))}function o(e){var n,t=null!==(n=e.requestOptions)&&void 0!==n?n:{headers:new Headers};return t.datapoint=t.datapoint||{},t.datapoint.mailbox="Default",t}t.d(n,"b",(function(){return r})),t.d(n,"a",(function(){return o}))},1603:function(e,n,t){"use strict";t.d(n,"a",(function(){return o}));var r=t(3),o=Object(r.action)("triggerReInitializeAccount",(function(e){return{userIdentity:e}}))},1856:function(e,n,t){"use strict";t.d(n,"a",(function(){return u}));var r=t(69),o=t(1603);t.d(n,"b",(function(){return o.a}));var c=new r.c((function(){return t.e(993).then(t.bind(null,2853))})),u=new r.a(c,(function(e){return e.getAndUpdateAccessToken}))},1991:function(e,n,t){"use strict";var r;t.d(n,"a",(function(){return r})),function(e){e[e.AccessRevoked=0]="AccessRevoked",e[e.AccountNotFound=1]="AccountNotFound",e[e.InvalidClient=2]="InvalidClient",e[e.InvalidCredentials=3]="InvalidCredentials",e[e.InvalidProvider=4]="InvalidProvider",e[e.MailboxDeprovisioned=5]="MailboxDeprovisioned",e[e.Transient=6]="Transient",e[e.PermissionDenied=7]="PermissionDenied",e[e.UserCancelled=8]="UserCancelled",e[e.AadAuth=9]="AadAuth",e[e.Unknown=10]="Unknown",e[e.ProviderUnavailable=11]="ProviderUnavailable"}(r||(r={}))},2225:function(e,n,t){"use strict";var r=t(69),o=t(2301),c=t(1991),u=t(0),i=t(2923);function s(e){return Object(u.__awaiter)(this,void 0,void 0,(function(){return Object(u.__generator)(this,(function(n){switch(n.label){case 0:return[4,Object(i.a)(e)];case 1:return[2,n.sent()]}}))}))}t.d(n,"g",(function(){return d})),t.d(n,"e",(function(){return l})),t.d(n,"h",(function(){return b})),t.d(n,"f",(function(){return f})),t.d(n,"i",(function(){return O})),t.d(n,"c",(function(){return o.b})),t.d(n,"a",(function(){return o.a})),t.d(n,"b",(function(){return c.a})),t.d(n,"d",(function(){return s}));var a=new r.c((function(){return Promise.all([t.e(0),t.e(2),t.e(3),t.e(4),t.e(6),t.e(39),t.e(744)]).then(t.bind(null,16345))})),d=new r.a(a,(function(e){return e.linkAccountAndGetAccessToken})),l=new r.a(a,(function(e){return e.getAllConnectedAccounts})),b=(new r.a(a,(function(e){return e.getConnectedAccount})),new r.a(a,(function(e){return e.addConnectedAccount})),new r.a(a,(function(e){return e.removeConnectedAccount}))),f=(new r.a(a,(function(e){return e.refreshConnectedAccountAccessToken})),new r.a(a,(function(e){return e.idpResponseHandler}))),O=new r.a(a,(function(e){return e.setAddConnectedAccountHandler}));"undefined"!=typeof window&&void 0!==window.Owa&&(window.Owa.lazyIdpResponseHandler=f)},2242:function(e,n,t){"use strict";t.d(n,"a",(function(){return o}));var r=t(31);function o(e){return Object(r.a)("GetOwaUserConfiguration",{},e)}},2301:function(e,n,t){"use strict";var r,o;t.d(n,"b",(function(){return r})),t.d(n,"a",(function(){return o})),function(e){e.Msa="Msa",e.TeamSnap="TeamSnap",e.MsaInt="MsaInt",e.Google="Google",e.ICloud="ICloud"}(r||(r={})),function(e){e.Active="Active",e.Revoked="Revoked",e.Error="Error"}(o||(o={}))},287:function(e,n,t){"use strict";var r=t(29),o=t(489),c=t(84),u=t(52);function i(){var e=Object(r.a)();if(!e||!e.SessionSettings)return u.d("SessionSettings not available"),"no-mailbox-id";var n=e.SessionSettings.UserEmailAddress;return Object(c.i)("doc-attachment-usePrimarySmtpAddressForMailboxId")?n:(e.SessionSettings.IsShadowMailbox?n=e.SessionSettings.LogonEmailAddress:Object(o.c)(e.HexCID,e.SessionSettings.UserEmailAddress)&&(n=Object(o.b)(e.HexCID,e.SessionSettings.NotManagedEmailAddresses,e.SessionSettings.UserProxyAddresses)),n)}var s=t(714),a=t(606);function d(e){var n=Object(a.a)().userMailboxInfoMap;n&&n.delete(e)}function l(e,n){return e===n||null!=e&&null!=n&&e.Id===n.Id}var b=t(490);t.d(n,"c",(function(){return i})),t.d(n,"d",(function(){return s.a})),t.d(n,"f",(function(){return d})),t.d(n,"e",(function(){return l})),t.d(n,"a",(function(){return o.a})),t.d(n,"b",(function(){return b.a}))},2923:function(e,n,t){"use strict";t.d(n,"a",(function(){return d}));var r=t(0),o=t(11),c=t(311),u=t(1991),i=t(325),s=t(2924),a="ows/beta/ConnectedAccounts/refreshtoken/{0}";function d(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var n=this;return Object(r.__generator)(this,(function(t){switch(t.label){case 0:return[4,Object(c.c)(Object(o.c)(a,e),null,void 0,!0).then((function(e){return Object(r.__awaiter)(n,void 0,void 0,(function(){var n,t,o;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return[4,e.json()];case 1:return n=r.sent(),t=n,Object(s.a)("refreshToken_serviceResponse",e,t),Object(i.a)(e.status)?[2,{ConnectedAccountResponse:n,isSuccess:!0}]:400==e.status||404==e.status?[2,{errorResponse:n,isSuccess:!1}]:(429==e.status&&(o=Number(e.headers.get("RetryAfter").slice(-2)),Object(s.b)(o,"refreshAccountToken")),[2,{errorResponse:{error:u.a[u.a.Transient]},isSuccess:!1}])}}))}))})).catch((function(e){return{errorResponse:{error:u.a[u.a.Unknown],errorDescription:JSON.stringify(e)},isSuccess:!1}}))];case 1:return[2,t.sent()]}}))}))}},2924:function(e,n,t){"use strict";t.d(n,"a",(function(){return c})),t.d(n,"b",(function(){return u}));var r=t(269),o=t(325);function c(e,n,t){var c=Object(o.a)(n.status);Object(r.p)(e,{isSuccess_1:c,status_2:n.status,errorCode:c?null:JSON.stringify(null==t?void 0:t.error),errorDescription:c?null:JSON.stringify(null==t?void 0:t.errorDescription)},{isCore:!0})}function u(e,n){var t={lowerBoundSeconds:null,upperBoundSeconds:null};t=e<=0?{lowerBoundSeconds:null,upperBoundSeconds:0}:e<=1?{lowerBoundSeconds:0,upperBoundSeconds:1}:e<=2?{lowerBoundSeconds:1,upperBoundSeconds:2}:e<=5?{lowerBoundSeconds:2,upperBoundSeconds:5}:e<=10?{lowerBoundSeconds:5,upperBoundSeconds:10}:e<=30?{lowerBoundSeconds:10,upperBoundSeconds:30}:e>60?{lowerBoundSeconds:30,upperBoundSeconds:60}:{lowerBoundSeconds:null,upperBoundSeconds:null},Object(r.p)("ConnectedAccounts429Error",{retryAfterLowerBound_1:t.lowerBoundSeconds,retryAfterUpperBound_2:t.upperBoundSeconds,apiName_3:n})}},311:function(e,n,t){"use strict";t.d(n,"d",(function(){return c})),t.d(n,"c",(function(){return u})),t.d(n,"e",(function(){return i})),t.d(n,"b",(function(){return s})),t.d(n,"a",(function(){return a})),t.d(n,"f",(function(){return d}));var r=t(69),o=new r.c((function(){return Promise.all([t.e(1),t.e(46),t.e(804)]).then(t.bind(null,888))})),c=new r.a(o,(function(e){return e.makePostRequest})).importAndExecute,u=new r.a(o,(function(e){return e.makePatchRequest})).importAndExecute,i=new r.a(o,(function(e){return e.makePutRequest})).importAndExecute,s=new r.a(o,(function(e){return e.makeGetRequest})).importAndExecute,a=new r.a(o,(function(e){return e.makeDeleteRequest})).importAndExecute,d=new r.a(o,(function(e){return e.sendOwsPrimeRequest})).importAndExecute},325:function(e,n,t){"use strict";var r=t(688);t.d(n,"a",(function(){return r.a}))},489:function(e,n,t){"use strict";t.d(n,"b",(function(){return s})),t.d(n,"c",(function(){return a})),t.d(n,"a",(function(){return d}));var r=t(0),o=t(29),c=t(490),u=t(84),i=t(52);function s(e,n,t){var o,c;if(t)try{for(var u=Object(r.__values)(t),i=u.next();!i.done;i=u.next()){var s=i.value;if(!a(e,s))return s}}catch(e){o={error:e}}finally{try{i&&!i.done&&(c=u.return)&&c.call(u)}finally{if(o)throw o.error}}return n&&n.length>0?n[0]:"NoResolvableAddress@invalid.outlook.com"}function a(e,n){return("outlook_"+e+"@outlook.com").toLowerCase()===n.toLowerCase()}function d(){var e=function(){var e=Object(o.a)();if(!e||!e.SessionSettings)return i.d("SessionSettings not available"),"no-routing-key";var n=e.SessionSettings.UserEmailAddress;if(0===e.SessionSettings.WebSessionType)return Object(c.a)()+n;if(Object(u.i)("doc-attachment-routingKeyPuid"))return"PUID:"+e.SessionSettings.UserPuid+"@"+e.SessionSettings.TenantGuid;if(e.SessionSettings.IsShadowMailbox)return Object(c.a)()+e.SessionSettings.LogonEmailAddress;if(a(e.HexCID,e.SessionSettings.UserEmailAddress))return Object(c.a)()+s(e.HexCID,e.SessionSettings.NotManagedEmailAddresses,e.SessionSettings.UserProxyAddresses);return Object(c.a)()+n}();return e=encodeURIComponent(e)}},490:function(e,n,t){"use strict";t.d(n,"a",(function(){return c}));var r=t(98),o=t(84);function c(e){var n=Object(r.i)(e);return n&&n.SessionSettings?0===n.SessionSettings.WebSessionType?Object(o.i)("doc-attachment-routingKeyAadSmtp")?"SMTP:":"":"MSA:":"no-routing-key:"}},606:function(e,n,t){"use strict";var r=t(3),o=t(18);n.a=Object(r.createStore)("OWAClientIdStore",{userMailboxInfoMap:new o.ObservableMap})},633:function(e,n,t){"use strict";var r=t(3),o=Object(r.action)("initializeOwaObservableDateTime"),c=Object(r.action)("observableNowChanged"),u=Object(r.action)("observableTodayChanged"),i=t(9),s=t(18),a=Object(r.createStore)("ObservableDateTime",{now:0,today:0}),d=Object(s.computed)((function(){return Object(i.lc)(a().now)})),l=function(){return d.get()},b=Object(s.computed)((function(){return Object(i.lc)(a().today)})),f=function(){return b.get()},O=function(e){return Object(i.Gb)(e,l())},v=function(e){return Object(i.Eb)(e,l())},p=function(e){return S(e,i.Gb)},j=function(e){return S(e,i.Hb)},S=function(e,n){return n(Object(i.Wb)(Object(i.lc)(e)),f())};function w(e){if(!e)return"";var n=Object(i.lc)(e);return function(e,n){var t=Object(i.Wb)(e);if(Object(i.Ib)(t,n))return i.Z;var r=function(e){return Object(i.Mb)(t,Object(i.e)(n,-e),n)};if(r(3))return i.hb;if(r(30))return i.gb;return i.X}(n,f())(n)}function A(e){if(!e)return"";var n=Object(i.lc)(e);return function(e,n){var t=Object(i.Wb)(e);if(Object(i.Ib)(t,n))return i.S;return i.T}(n,f())(n)}function h(e){return e?function(e,n){var t=Object(i.Wb)(e);return Object(i.Ib)(t,n)?Object(i.Z)(e):g(t,n,2)?Object(i.kb)(e):g(t,n,7)?Object(i.H)(Object(i.ab)(e),Object(i.Z)(e)):Object(i.H)(Object(i.J)(e),Object(i.Z)(e))}(Object(i.lc)(e),f()):""}function g(e,n,t){return Object(i.Mb)(e,Object(i.e)(n,-t),n)}var m=Object(r.action)("updateTimes"),y=Object(r.action)("setNow"),x=Object(r.action)("setToday",(function(e){return{today:e}}));Object(r.mutator)(y,(function(){a().now=Object(i.jc)()})),Object(r.mutator)(x,(function(e){var n=e.today;a().today=n}));var _=t(30),C=t(123);Object(r.orchestrator)(o,(function(){m();var e=Object(i.Pb)(),n=Object(i.Yb)(Object(i.h)(e,1)),t=Object(i.w)(n,e);setTimeout((function(){return setInterval(m,_.g)}),t)})),Object(r.orchestrator)(C.l,(function(){m()})),Object(r.orchestrator)(m,(function(){y();var e=Object(i.zb)(Object(i.kc)()),n=a().today!=e;n&&x(e),c(),n&&u()})),t.d(n,"d",(function(){return o})),t.d(n,"j",(function(){return c})),t.d(n,"l",(function(){return u})),t.d(n,"i",(function(){return l})),t.d(n,"k",(function(){return f})),t.d(n,"g",(function(){return O})),t.d(n,"e",(function(){return v})),t.d(n,"f",(function(){return p})),t.d(n,"h",(function(){return j})),t.d(n,"a",(function(){return w})),t.d(n,"b",(function(){return A})),t.d(n,"c",(function(){return h}))},688:function(e,n,t){"use strict";function r(e){return e>=200&&e<300}t.d(n,"a",(function(){return r}))},714:function(e,n,t){"use strict";t.d(n,"a",(function(){return u}));var r=t(489),o=t(98),c=t(606);function u(e){var n=Object(c.a)().userMailboxInfoMap;if(!n||!n.get(e)){var t=!1;e&&(t=e!=Object(o.b)());var u={type:"UserMailbox",userIdentity:t?e:Object(o.b)(),mailboxSmtpAddress:t?e:Object(o.c)(),routingKey:Object(r.a)(),requestOptions:null};return n.set(e,u),u}return n.get(e)}}}]);
//# sourceMappingURL=owa.MailBoot~owa-account-store-init.js.map
self.scriptsLoaded['owa.MailBoot~owa-account-store-init.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.MailBoot~owa-account-store-init.js'] = (new Date()).getTime();